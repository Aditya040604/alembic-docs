## What is Alembic used for?
## 🧱 What is Alembic?

**Alembic** is a **database migration tool** for **SQLAlchemy**.  
Think of it as **Git for your database schema**.

It helps you:

- Track changes to your **database schema** over time,
    
- Upgrade/downgrade your schema automatically,
    
- Keep your **models (code)** and **database tables** in sync.
    

---

## 🧩 Why You Need It

Let’s say you’re building a project with SQLAlchemy ORM.

Initially, your `User` model looks like this:

```python
class User(Base):
    __tablename__ = "users"
    id = Column(Integer, primary_key=True)
    username = Column(String(50), unique=True)
```

So you run `alembic upgrade head` — it creates a table with `id` and `username`.

Later, you add a new column:

```python
email = Column(String(100), unique=True)
```

If you **don’t use Alembic**, you’d have to manually run SQL like:

```sql
ALTER TABLE users ADD COLUMN email VARCHAR(100) UNIQUE;
```

That’s tedious, error-prone, and hard to track in teams. 😩  
With **Alembic**, it’s as simple as:

```bash
alembic revision --autogenerate -m "Add email column to users"
alembic upgrade head
```

Boom 💥  
Alembic reads your models, compares them to your database schema, generates a migration script, and applies it safely.

---

## ⚙️ How Alembic Works Internally

Here’s the **mental model** 👇

```
📁 alembic/
 ┣ 📄 env.py                # Configures how Alembic connects to DB
 ┣ 📄 script.py.mako        # Template for new migration files
 ┗ 📁 versions/
     ┣ 🧾 <revision_id>_create_users_table.py
     ┣ 🧾 <revision_id>_add_email_column.py
```

Each migration file contains two key functions:

```python
def upgrade():
    # What to do when migrating forward
    op.add_column('users', sa.Column('email', sa.String(100)))

def downgrade():
    # What to do when rolling back
    op.drop_column('users', 'email')
```

---

## 🪜 Alembic Command Flow

|Command|Description|
|---|---|
|`alembic init alembic`|Initialize migration folder|
|`alembic revision -m "message"`|Create empty migration script|
|`alembic revision --autogenerate -m "message"`|Auto-generate migration from models|
|`alembic upgrade head`|Apply latest migrations|
|`alembic downgrade -1`|Roll back one migration|
|`alembic current`|Show current migration version|
|`alembic history`|Show migration history|

---

## 🧠 Example Workflow

Let’s visualize this:

```
Base model --> (Alembic autogenerate) --> Migration Script --> Database Schema
```

1️⃣ Define your SQLAlchemy models  
2️⃣ Run:

```bash
alembic revision --autogenerate -m "create users table"
```

3️⃣ Then:

```bash
alembic upgrade head
```

4️⃣ Database updated ✅

If later you modify models again → repeat steps 2 & 3.

---

## 📊 Diagram: Alembic Lifecycle

```
         ┌────────────────┐
         │ SQLAlchemy ORM │
         └───────┬────────┘
                 │ models.py
                 ▼
       ┌──────────────────────┐
       │ Alembic (autogenerate│
       │   compares models &  │
       │   DB schema)         │
       └─────────┬────────────┘
                 │
        creates migration scripts
                 │
                 ▼
        ┌────────────────┐
        │ Database schema│
        └────────────────┘
```

---

## 🧩 Integration in FastAPI Projects

You’ll usually see Alembic integrated like this:

```
project/
├── alembic/
├── app/
│   ├── models/
│   └── database.py  # engine, Base, etc.
├── .env
└── alembic.ini
```

And your `env.py` (in `alembic/`) is configured to import your SQLAlchemy `Base`:

```python
from app.database import Base
target_metadata = Base.metadata
```

So Alembic knows what to compare against your database schema.

---

## 🚀 Forward-thinking Tip

In modern setups (like async FastAPI with SQLAlchemy 2.0), Alembic:

- Works fine even with async engines (you use `run_sync()` in `env.py`)
    
- Can be extended to support multiple schemas or tenants
    
- Plays well with CI/CD pipelines (you can run migrations automatically before deployment)
    

---

## 🧩 TL;DR

|Concept|Summary|
|---|---|
|Alembic|Database migration tool for SQLAlchemy|
|Purpose|Keeps DB schema synced with your models|
|Key Commands|`revision`, `upgrade`, `downgrade`|
|Works With|SQLAlchemy, FastAPI, Flask|
|Analogy|It’s like Git for your database schema|

---

Would you like me to show a **real working example** (with code and folder structure) of using Alembic in a FastAPI + SQLAlchemy project?  
That would make this super concrete.